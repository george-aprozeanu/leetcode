#include <stdio.h>
#include <malloc.h>
#include <stdint.h>
#include <stdbool.h>

typedef struct {
    bool busy;
    int key;
    long value;
} IntHashMapEntry;

#define IntHashMap_Size 80000

typedef struct {
    IntHashMapEntry values[IntHashMap_Size];
} IntHashMap;

void IntHashMapEntry_set(IntHashMapEntry *entry, int key, int value) {
    entry->busy = true;
    entry->key = key;
    entry->value = value;
};

IntHashMapEntry *IntHashMap_get(IntHashMap *hashMap, int key) {
    const size_t index = key % IntHashMap_Size;
    for (size_t i = index; i < IntHashMap_Size; i++) {
        IntHashMapEntry *entry = &hashMap->values[i];
        if (entry->key == key && entry->busy == true) {
            return entry;
        }
        if (entry->busy == false) return NULL;
    }
    for (size_t i = 0; i < index - 1; i++) {
        // printf("at index %d, hash %d\n", i, index);
        IntHashMapEntry *entry = &hashMap->values[i];
        if (entry->key == key && entry->busy == true) {
            return entry;
        }
        if (entry->busy == false) return NULL;
    }
    return NULL;
}

void IntHashMap_add(IntHashMap *hashMap, int key, int value) {
    const size_t index = key % IntHashMap_Size;
    for (size_t i = index; i < IntHashMap_Size; i++) {
        if (hashMap->values[i].busy == false) {
            IntHashMapEntry_set(&hashMap->values[i], key, value);
            return;
        }
    }
    for (size_t i = 0; i < index - 1; i++) {
        // printf("at index %d, hash %d\n", i, index);
        if (hashMap->values[i].busy == false) {
            IntHashMapEntry_set(&hashMap->values[i], key, value);
            return;
        }
    }
}

int *twoSum(const int *nums, const int numsSize, const int target, int *returnSize) {
    IntHashMap hashMap = {};
    *returnSize = 2;
    int *ret = malloc(*returnSize * sizeof(int));
    for (int i = 0; i < IntHashMap_Size; i++) hashMap.values[i].busy = false;
    for (int i = 0; i < numsSize; i++) {
        IntHashMap_add(&hashMap, nums[i], i);
    }
    for (int i = 0; i < numsSize; i++) {
        const IntHashMapEntry *entry = IntHashMap_get(&hashMap, target - nums[i]);
        if (entry != NULL && entry->value != i) {
            ret[0] = entry->value;
            ret[1] = i;
        }
    }
    return ret;
}

int main() {
    int nums[] = {
        3836605, -3447751, 9801209, 5832189, -9653471, -2175755, -7118277, 4299656, -6860065, -5035791, 2069942,
        2915745, -8199133, 6234167, -4890801, -5000943, 6342126, 5900550, 3620534, 3051341, 6123246, 4993479, 1565729,
        -9292195, 4084546, -3274993, -4972971, -4156289, -9368914, -1156916, 573634, -3388169, 2750946, -5293730,
        -9747055, 653345, 4769879, -6451944, -4781780, 8968674, -4703615, -8170190, -8152404, -4746655, 9495143, 57713,
        -7715489, -2527604, -3839094, 6527552, 9778834, 8966578, 9261440, 1564186, 9123288, -4738086, 3538059, -8247254,
        -8477609, -5104832, -2479755, 626521, 7171228, 8609843, -6278485, 1961977, 5556249, -3990242, -7011426,
        -1009568, -1253398, -6409021, 7510422, -9859362, 786294, -9978377, -1795057, -3910961, 6494963, -6212837,
        7581133, -2946334, -920996, 8770809, 631917, -2752842, 810680, 2127375, 1552573, 8029251, -6988215, 2116878,
        1293463, 380489, 3447936, -1302877, 1214898, -8875402, -2170773, 4511321, 6639587, -9636285, 1835591, -8553549,
        9251126, -4164326, 5876785, 7482121, -2641035, -9079545, 2837533, -3052488, -8014881, 7371763, -8111958,
        -8036789, 8320871, 4091702, 8689169, 4837472, -7812150, 3706069, -3324989, 4849222, 8076986, -8565448, 2697733,
        -8441017, -995761, -4535888, 7242419, -2132465, -1770116, 7382586, 2646981, 2045040, -8590121, -9623259,
        -2864984, 8590496, -9747620, 6101249, -5210521, -9208542, -394889, 3527075, -3165043, 8305337, -8178928, 428757,
        7387265, 188463, -458551, -9274591, -6309455, 3335425, -2137671, -7865107, -4605716, 110681, 6430568, -6740170,
        3771367, 3555598, -1955544, -8733578, -5683391, -8557833, -2633973, 4118083, 5926283, 4538982, -4034823,
        3249569, 120243, -8504418, -536795, 8253834, 9585282, -549538, -9318417, 2298562, 8334659, 7982089, 2485293,
        -8630103, 5199037, 5378173, 9209034, 7570595, 8498248, 6554512, 4002050, -3774115, 8138658, -1915589, 6871801,
        6656599, -2906196, -3032833, 7470858, -496856, 3722092, 63460, 1697836, 1762898, -3640589, -289710, 9291212,
        1877399, -6514175, -5764773, 1292979, -8632760, 8433489, -3692123, -3514738, -7713712, 7950406, 6933942,
        -7543278, 5317357, 1902156, -2020119, 8912291, -3246710, -9831306, 9931189, 848437, -175509, 9290646, -4612531,
        1110864, -998787, -8166382, 8456316, 1117499, -7489018, 5458856, 7724271, -7476004, 5656718, 9585269, 9557976,
        -7450077, 5531398, -9731318, 1449700, 5013298, -5530591, -6594370, 6310733, 6606821, 4693027, -3309847, 9450049,
        -1271092, -6830291, 877997, 6122442, -5440709, -8543439, 6724562, -6683877, 1898137, -7797193, 5615647, 4810538,
        9265369, -1372987, 2034781, 3210908, -4516723, 3898798, -7637128, -3926376, 8958146, 4864888, -6180309, 9193359,
        -3196033, 8494366, 9196830, 8707390, 7312683, -4447122, -7335977, -911956, -3889317, -7411441, 6587762,
        -3163580, 6621960, 8841600, 2551394, 7738897, 8249521, -7224711, 3517473, 6511513, -2938113, 6412340, 6333869,
        -6795312, -3395970, -847418, 8032568, 6093357, -8529120, 8674711, -9083417, -956961, -5572790, 5138917, 8401944,
        4285489, -3080500, 5987398, 7831252, 842679, -5459786, -2035059, 8248254, 8719819, -9476210, 9088222, -1570495,
        -1521953, 6906891, -8069577, -7813884, 7431390, 2309068, 278599, 7007155, -5027561, 5076924, 4971213, -2550180,
        -6584905, 3036582, 1071444, -338718, 2958144, -3556294, -3838998, 3141573, 477777, 8842467, -8109132, 8119889,
        -2660041, -7901095, 5806738, -3526318, 3384195, -7921529, -8847310, -8956526, -6415150, 5499063, -6030674,
        -7606782, -4415655, 6053920, -984052, -3586055, -5980498, -823735, 8386, -2008334, -7980226, 9774984, 9296974,
        -7444602, -3752048, 6563058, 2247599, -5074172, -4760498, 8478734, 4350940, 9856117, 3945112, 4718690, -2655196,
        -1692614, 4435795, 5765667, -9493883, 1029212, -9971675, -850831, 3832058, -4625964, 8200119, -9402763, 9575364,
        -4486149, 8426678, 6184874, 7189264, 3867336, -8891783, -4979969, 8287568, -7742154, 2317846, 6870609, -5815832,
        -471849, 3343917, -8493153, 9609660, 2551285, -6511226, 6872171, 6955936, -3853021, 5651545, 8063777, 5824900,
        591302, -522852, 7061239, -9652043, -2858544, -9602897, -4064710, 8804701, -2297809, 1327537, 5167659, 4476363,
        -9072863, -4095817, -2079255, -706284, 5501127, 6155243, -2945475, -3703711, -6038785, -3553153, 4876851,
        2295516, -7270763, -4572312, 4022412, -2073910, -3676273, 3279654, 44944, -8232375, -7294979, 6163407, 6680812,
        -6086546, 6267118, -4074152, 2187219, -3024373, 2765407, -3710090, 5513561, -5945099, -7541800, 8895469,
        3387894, -1540391, -9812821, -6474308, 3792959, -3052081, 8803887, -1624290, 9396813, 7705948, 6208323,
        -5549510, -6052262, 8653068, -998631, 9961328, -9568960, 2157494, 7869820, 68279, -1991508, -1122783, 3994543,
        6275367, -8504546, -8066742, 256093, 5833960, 6056030, 7754840, 4113552, 4488464, 9051954, 1775272, 9048608,
        6373459, 6588404, -5306994, 4355630, -392942, -6258621, -1328924, -226147, -7991773, 4312782, 432347, 5425846,
        4049286, 5620553, 3018597, 2424318, -5891329, 7875402, -4915503, -7584619, -4050888, 9468081, -8009964, -322992,
        6541505, 3763530, 5671873, 59530, -393031, 6978373, 4471968, -8817687, 2545643, -3032984, 4980708, -9689636,
        -4108936, -7607594, 9488015, 2572068, -5294975, 6201815, -517665, 3048344, -6140228, 3041010, -95248, -7451209,
        561597, 2099223, 8000973, 8213616, -2731599, 7817503, -2755783, -8849920, -1904103, 6005130, 3520931, 9334337,
        -8049853, 5319352, 5832226, -2598141, -4887806, 540234, 2985516, -307687, 6847275, -3456315, -1192851, -1187512,
        -3915859, -2991726, -987916, -8924460, -4112402, -7014840, 5277941, 2561960, -9730837, -3766251, -5828634,
        8213835, -6613261, -1940917, 5461226, -2126189, -8023682, -4941945, -7895433, 2074342, 3959159, -1611258,
        5334308, -1657529, 9357155, -3010774, -8697973, 3287222, -6214259, 5110701, 3872695, 9802287, 7466262, -4051933,
        -1644521, -6585623, -48901, 1570078, 6251187, -2302909, 5203871, -9542985, 7647308, -1499299, -8658943,
        -1962591, -1267368, -1969063, 978563, -1358763, -8006739, -5883132, -5653029, -6418407, -4375855, 8108157,
        -9347810, 5605684, 6458185, 624230, -7435348, -3349524, -8350468, 3740117, -9153120, -5670335, 5473735,
        -6084920, 9952122, -8167162, -3778507, 8616014, 9744182, -2703400, 2035720, -7403314, 9904670, -5767558,
        6921081, -4784917, 1723105, -5406633, 5800907, -2175843, -1069543, -6211125, -643863, 826016, 6958731, -8761435,
        -9125067, -8515318, 5276364, 3765931, -5168407, 9767686, -9833748, 7407665, -6500288, 8418099, 6901558,
        -9850914, 3868725, 8205651, -7292384, 266441, -3636649, 365069, -4166922, -6531954, 6239561, 2031320, -7924092,
        -2597780, -1495571, -5935755, 733819, -255386, 5789177, -8189538, -9970078, 8033190, -9911893, 1546600,
        -5990863, -8772357, 3616183, 6745417, -5485331, -3111906, -9424170, -61811, 1259706, 4441948, 2233291, -4402959,
        8768771, -5123560, -6359407, -1476771, -2165869, 1980656, -5257850, 3058175, -3205003, -5234710, -4440446,
        -8472049, 7791959, -4376564, -8696323, 8202455, -7031397, -5463598, 7526189, 8242685, -294706, -4388878,
        -8448017, 1800730, 9176831, 9627184, 8232295, -4890900, 8003100, -2223911, -4325179, 1368802, -3867223, 9356971,
        -4741377, -9842418, 9242750, -1837074, 8267288, -6771851, -4029315, -5287294, -8540663, 6259278, 2268532,
        7379052, -4412715, -5586954, -8062940, 5123237, 3127823, -8811518, 9796958, 2355039, -2028146, 204634, -9179494,
        -1389221, -8396301, 9571658, -3081293, -1584177, 9907683, -2464655, -2533860, 8127971, 7934033, 9980670,
        -7832854, 235378, 390154, -6834927, 2688575, -9117210, -6612360, -4606350, 8132792, 9010112, -9481585, -889534,
        -3480021, 752172, 1669301, -1902098, -9008727, -7659928, -6439566, 4756025, -7863284, -8621776, -1983144,
        -1793047, 9765493, 1514074, 7646270, 542037, 8575034, -68642, -4404791, -5676172, 5046973, 1673617, 6890470,
        -7785625, -4932311, 6330931, -2916502, -6281879, 3128898, -1799847, 9143475, 7601446, 1343036, 7976881, -21938,
        9242365, 9556637, -1576945, -1501760
    };
    int returnSize = 0;
    int *returnValue = twoSum(nums, sizeof(nums) / sizeof(int), 388854, &returnSize);
    printf("ret %d %d\n", returnValue[0], returnValue[1]);
    free(returnValue);
}
